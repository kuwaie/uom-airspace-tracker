<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Tokenè·å–å·¥å…·</title>
    <style>
        body { font-family: 'Microsoft YaHei', sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; line-height: 1.6; }
        .step { background: #f8f9fa; padding: 20px; margin: 15px 0; border-radius: 8px; border-left: 4px solid #3498db; }
        .code { background: #2c3e50; color: #ecf0f1; padding: 20px; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 14px; line-height: 1.4; white-space: pre-wrap; }
        button { background: #3498db; color: white; border: none; padding: 12px 20px; border-radius: 6px; cursor: pointer; font-size: 14px; margin: 10px 5px; }
        button:hover { background: #2980b9; }
        .tip { background: #fff3cd; border: 1px solid #ffeaa7; padding: 12px; border-radius: 6px; margin: 10px 0; font-size: 14px; }
        .success { background: #d4edda; color: #155724; padding: 10px; border-radius: 5px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>ğŸ”‘ Tokenè·å–å·¥å…·</h1>
    
    <div class="step">
        <h3>ğŸ“‹ ä½¿ç”¨æ­¥éª¤ï¼š</h3>
        <p>1. æ‰“å¼€ <a href="https://uom.caac.gov.cn" target="_blank">UOMç©ºåŸŸæŸ¥è¯¢é¡µé¢</a> å¹¶ç™»å½•</p>
        <p>2. æ‰§è¡Œç©ºåŸŸæŸ¥è¯¢æ“ä½œï¼ˆç¡®ä¿æœ‰ç½‘ç»œè¯·æ±‚äº§ç”Ÿï¼‰</p>
        <p>3. æŒ‰ <kbd>F12</kbd> æ‰“å¼€å¼€å‘è€…å·¥å…·</p>
        <p>4. é€‰æ‹© <strong>"æ§åˆ¶å°(Console)"</strong> æ ‡ç­¾é¡µ</p>
        <p>5. å¤åˆ¶ä¸‹æ–¹ä»£ç ç²˜è´´åˆ°æ§åˆ¶å°ï¼ŒæŒ‰ <kbd>Enter</kbd> è¿è¡Œ</p>
    </div>

    <div class="tip">
        <strong>ğŸ’¡ æç¤ºï¼š</strong> å¦‚æœç¬¬ä¸€æ¬¡è¿è¡Œæ²¡æœ‰æ‰¾åˆ°Tokenï¼Œè¯·ç¡®ä¿å·²æ‰§è¡ŒæŸ¥è¯¢æ“ä½œï¼Œç„¶åé‡æ–°è¿è¡Œä»£ç ã€‚
    </div>

    <div class="code" id="code">// Tokenæå–åŠ©æ‰‹ - åœ¨UOMé¡µé¢æ§åˆ¶å°è¿è¡Œ
(function() {
    console.log('ğŸ”‘ Tokenæå–åŠ©æ‰‹å¯åŠ¨...');
    
    const tokens = {
        tianditu: new Set(),
        airspace: new Set()
    };
    
    function extractTokensFromIframe() {
        const iframe = document.querySelector('iframe');
        if (!iframe) {
            console.log('âŒ æ²¡æœ‰æ‰¾åˆ°iframeï¼Œä»ç½‘ç»œè¯·æ±‚ä¸­æå–...');
            extractFromPerformance();
            return;
        }
        
        try {
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
            const images = iframeDoc.querySelectorAll('img');
            
            console.log(`ğŸ“Š æ‰«æ ${images.length} ä¸ªå›¾ç‰‡å…ƒç´ ...`);
            
            images.forEach(img => {
                const src = img.src;
                if (src.includes('tianditu.gov.cn') && src.includes('tk=')) {
                    const match = src.match(/tk=([^&]+)/);
                    if (match) {
                        tokens.tianditu.add(match[1]);
                        console.log('âœ… å‘ç°å¤©åœ°å›¾Token');
                    }
                }
                if (src.includes('uom.caac.gov.cn/map/airspace') && src.includes('token=')) {
                    const match = src.match(/token=([^&]+)/);
                    if (match) {
                        tokens.airspace.add(match[1]);
                        console.log('âœ… å‘ç°ç©ºåŸŸToken');
                    }
                }
            });
            
            displayResults();
            
        } catch(e) {
            console.log('âŒ æ— æ³•è®¿é—®iframeå†…å®¹ï¼Œä»ç½‘ç»œè¯·æ±‚ä¸­æå–...');
            extractFromPerformance();
        }
    }
    
    function extractFromPerformance() {
        const resources = performance.getEntriesByType('resource');
        console.log(`ğŸ“Š æ‰«æ ${resources.length} ä¸ªç½‘ç»œè¯·æ±‚...`);
        
        resources.forEach(entry => {
            const url = entry.name;
            if (url.includes('tianditu.gov.cn') && url.includes('tk=')) {
                const match = url.match(/tk=([^&]+)/);
                if (match) {
                    tokens.tianditu.add(match[1]);
                    console.log('âœ… å‘ç°å¤©åœ°å›¾Token');
                }
            }
            if (url.includes('uom.caac.gov.cn/map/airspace') && url.includes('token=')) {
                const match = url.match(/token=([^&]+)/);
                if (match) {
                    tokens.airspace.add(match[1]);
                    console.log('âœ… å‘ç°ç©ºåŸŸToken');
                }
            }
        });
        displayResults();
    }
    
    function displayResults() {
        console.log('\\nğŸ¯ === TOKENæå–ç»“æœ ===');
        
        if (tokens.tianditu.size > 0) {
            console.log('ğŸ—ºï¸ å¤©åœ°å›¾Token:');
            tokens.tianditu.forEach(token => console.log(`   ${token}`));
        } else {
            console.log('âŒ æœªæ‰¾åˆ°å¤©åœ°å›¾Token');
        }
        
        if (tokens.airspace.size > 0) {
            console.log('âœˆï¸ ç©ºåŸŸToken:');
            tokens.airspace.forEach(token => console.log(`   ${token}`));
        } else {
            console.log('âŒ æœªæ‰¾åˆ°ç©ºåŸŸToken');
        }
        
        if (tokens.tianditu.size > 0 || tokens.airspace.size > 0) {
            console.log('\\nğŸ“‹ å¤åˆ¶æ ¼å¼:');
            tokens.tianditu.forEach(token => console.log(`å¤©åœ°å›¾Token: ${token}`));
            tokens.airspace.forEach(token => console.log(`ç©ºåŸŸToken: ${token}`));
            console.log('\\nğŸ’¡ æç¤ºï¼šé€‰ä¸­Tokenæ–‡æœ¬ï¼Œå³é”®å¤åˆ¶å³å¯');
        } else {
            console.log('\\nğŸ” å»ºè®®ï¼šè¯·ç¡®ä¿å·²æ‰§è¡ŒæŸ¥è¯¢æ“ä½œï¼Œç„¶åé‡æ–°è¿è¡Œæ­¤ä»£ç ');
        }
    }
    
    // æ‰§è¡Œæå–
    extractTokensFromIframe();
    console.log('âœ… Tokenæå–åŠ©æ‰‹æ‰§è¡Œå®Œæˆ');
})();</div>

    <button onclick="copyCode()">ğŸ“‹ å¤åˆ¶ä»£ç </button>
    <button onclick="testCode()">ğŸ§ª æµ‹è¯•ä»£ç è¯­æ³•</button>

    <div id="message" class="hidden"></div>

    <div class="step">
        <h3>â“ å¸¸è§é—®é¢˜</h3>
        <p><strong>Q: è¿è¡Œåæ²¡æœ‰æ‰¾åˆ°Tokenï¼Ÿ</strong></p>
        <p>A: è¯·ç¡®ä¿å·²åœ¨UOMé¡µé¢æ‰§è¡Œäº†æŸ¥è¯¢æ“ä½œï¼Œç„¶åé‡æ–°è¿è¡Œä»£ç ã€‚</p>
        
        <p><strong>Q: æ§åˆ¶å°æ˜¾ç¤ºé”™è¯¯ï¼Ÿ</strong></p>
        <p>A: è¯·æ£€æŸ¥æ˜¯å¦åœ¨æ­£ç¡®çš„é¡µé¢è¿è¡Œï¼Œå¹¶ç¡®ä¿ä»£ç å®Œæ•´å¤åˆ¶ã€‚</p>
    </div>

    <script>
        function copyCode() {
            const code = document.getElementById('code').textContent;
            navigator.clipboard.writeText(code).then(() => {
                showMessage('âœ… ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼è¯·åˆ°UOMé¡µé¢æ§åˆ¶å°è¿è¡Œã€‚');
            }).catch(() => {
                showMessage('âŒ å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©ä»£ç å¤åˆ¶ã€‚');
            });
        }

        function testCode() {
            try {
                // æµ‹è¯•ä»£ç è¯­æ³•æ˜¯å¦æ­£ç¡®
                const code = document.getElementById('code').textContent;
                new Function(code);
                showMessage('âœ… ä»£ç è¯­æ³•æ£€æŸ¥é€šè¿‡ï¼');
            } catch (e) {
                showMessage('âŒ ä»£ç è¯­æ³•æœ‰è¯¯ï¼š' + e.message);
            }
        }

        function showMessage(text) {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = text;
            messageDiv.className = text.includes('âœ…') ? 'success' : 'tip';
            messageDiv.classList.remove('hidden');
            
            setTimeout(() => {
                messageDiv.classList.add('hidden');
            }, 3000);
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºæ¶ˆæ¯
        window.addEventListener('load', function() {
            showMessage('ğŸ” è¯·ç¡®ä¿åœ¨UOMé¡µé¢æ‰§è¡ŒæŸ¥è¯¢æ“ä½œåè¿è¡Œä»£ç ');
        });
    </script>
</body>
</html>